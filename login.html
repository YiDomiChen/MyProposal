<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <script src="https://www.gstatic.com/firebasejs/4.5.0/firebase.js"></script>
  <script src="https://www.gstatic.com/firebasejs/4.2.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/4.2.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/4.2.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/4.2.0/firebase-messaging.js"></script>
  <title>Test</title>
  
  <!--<link href="https://fonts.googleapis.com/css?family=Roboto:300,500" rel="stylesheet"> -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  
  
</head>
<body>
  It is <span id="value"> </span> today
  
  <div class="container">
	<input id="txtEmail" type="email" placeholder="Email">
	
	<input id="txtPassword" type="password" placeholder="Password">
	
	<button id="btnLogin" class="btn btn-action">
	 Log in
	</button>
	
	<button id="btnSignUp" class="btn btn-secondary">
	 Sign Up
	</button>
	
	<button id="btnLogout" class="btn btn-action hide">
	 Log out
	</button>
  </div>
	
	
  
   <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyCCMcd6IQe1VjhjElv-ExFqOYAdD14S4v0",
      authDomain: "myproposal-be581.firebaseapp.com",
      databaseURL: "https://myproposal-be581.firebaseio.com",
      projectId: "myproposal-be581",
      storageBucket: "myproposal-be581.appspot.com",
      messagingSenderId: "128814836934"
    };
    firebase.initializeApp(config);
	//use for auth
	//Get  elements
	const txtEmail =document.getElementById('txtEmail');
	const txtPassword = document.getElementById('txtPassword');
	const btnLogin = document.getElementById('btnLogin');
	const btnSignUp = document.getElementById('btnSignUp');
	const btnLogout = document.getElementById('btnLogout');
	
	//add login
	btnLogin.addEventListener('click', e => {
	
	const email =txtEmail.value;
	const pass =txtPassword.value;
	const auth=firebase.auth();
	
	//sign in
	const promise= auth.signInWithEmailAndPassword(email,pass);
	promise.catch(e => console.log(e.message));
	
	
	
	});
	
	//signup
	btnSignUp.addEventListener('click', e =>{
	//TODO:check 4 real email
	const email =txtEmail.value;
	const pass =txtPassword.value;
	const auth=firebase.auth();
	

	
	//sign in
	const promise= auth.createUserWithEmailAndPassword(email,pass);
	promise
		//.then(user => console.log(user))
		.catch(e => console.log(e.message));
	
	});
	
	btnLogout.addEventListener('click', e => {
		firebase.auth().signOut();
	});
	
	//add a realtime listener
	firebase.auth().onAuthStateChanged(firebaseUser =>{
		if (firebaseUser){
			console.log(firebaseUser);
			btnLogout.classList.remove('hide');
			
			var user = firebase.auth().currentUser;

			user.sendEmailVerification().then(function() {
			// Email sent.
			}).catch(function(error) {
			// An error happened.
			});
			
			
		}else {
			console.log('not logged in');
			btnLogout.classList.add('hide');
		}
	});
	
	//const auth = firebase.auth();
	//auth.signInWithEmailAndPassword(email,pass);
	//auth.createUserWithEmailAndPassword(email,pass);
	//auth.onAuthStateChanged(firebaseUser => { });
	//https://www.youtube.com/watch?v=-OKrloDzGpU
	
    var value = document.getElementById("value");
    var dbRef = firebase.database().ref().child("User/001");
    dbRef.on('value', function(snap) {
      snap.forEach(function(child) {
        console.log(child.key + ":" + child.val()["email"]);
      });
      value.innerText = snap.val()["email"];
    });
  </script>
</body>
</html>